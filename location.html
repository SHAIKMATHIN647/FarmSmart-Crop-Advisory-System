<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: url('images/bg.jpg') no-repeat center center fixed;
    background-size: cover;
    padding: 40px;
    margin: 0;
  }

  h2 {
    color: #388e3c;
    font-size: 28px;
  }

  button {
    background-color: #66bb6a;
    color: white;
    padding: 12px 20px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: background 0.3s;
  }

  button:hover {
    background-color: #558b2f;
  }

  #recommendation-result {
    margin-top: 25px;
    padding: 24px;
    background-color: #ffffff;
    border-radius: 14px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    line-height: 1.6;
    animation: fadeIn 0.6s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h3 {
    margin-top: 20px;
    color: #2e7d32;
  }

  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 13px;
    color: white;
    font-weight: bold;
    margin-right: 6px;
  }

  .soil { background-color: #8d6e63; }
  .temp { background-color: #ff7043; }
  .season { background-color: #42a5f5; }

  ul {
    padding-left: 20px;
    margin: 0;
  }

  .loading {
    display: inline-block;
    width: 22px;
    height: 22px;
    border: 3px solid #c8e6c9;
    border-top: 3px solid #4caf50;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 10px;
    vertical-align: middle;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .icon-section {
    font-size: 22px;
    margin-top: 8px;
    margin-bottom: 12px;
    color: #689f38;
  }

  li {
    margin-bottom: 6px;
  }
</style>

<h2>üåæ Smart Crop Recommendations</h2>
<button onclick="recommendCrops()">Get Crop Suggestions üåø</button>
<div id="recommendation-result"></div>

<script>
  function recommendCrops() {
    const output = document.getElementById("recommendation-result");
    output.innerHTML = `<div class="loading"></div> Fetching soil and weather data...`;

    if (!navigator.geolocation) {
      output.innerHTML = "‚ùå Geolocation not supported.";
      return;
    }

    navigator.geolocation.getCurrentPosition(async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const weatherAPIKey = "a63b0e18099c21bd9c5e7ce9f319410d";

      try {
        const soilRes = await fetch(`https://rest.isric.org/soilgrids/v2.0/properties/query?lon=${lon}&lat=${lat}&property=phh2o&property=ocd`, {
          headers: { Accept: "application/json" }
        });
        const soilData = await soilRes.json();
        const ph = soilData.properties.phh2o?.layers?.[0]?.depths?.[0]?.values?.mean || 7;
        const carbon = soilData.properties.ocd?.layers?.[0]?.depths?.[0]?.values?.mean || 10;

        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${weatherAPIKey}`);
        const weatherData = await weatherRes.json();
        const temp = weatherData.main.temp;

        const month = new Date().getMonth() + 1;
        let season = "Unknown";
        if ([6, 7, 8, 9].includes(month)) season = "üåßÔ∏è Kharif";
        else if ([10, 11, 12, 1].includes(month)) season = "üåæ Rabi";
        else season = "‚òÄÔ∏è Zaid";

        let crops = [];
        let activities = [];

        if (ph >= 6 && ph <= 7.5 && temp >= 25 && temp <= 35 && season.includes("Kharif")) {
          crops.push("üåæ Rice", "üåø Soybean", "üåΩ Maize", "üçÖ Tomato", "üå∂Ô∏è Chilli");
          activities.push("üöú Prepare land with good drainage & seed beds for rice and maize.");
        }

        if (ph >= 6 && ph <= 7 && temp >= 15 && temp <= 30 && season.includes("Rabi")) {
          crops.push("ü•î Potato", "üåæ Wheat", "ü•¨ Mustard", "üåΩ Barley", "üßÑ Garlic");
          activities.push("üå± Sow wheat and barley with minimal tillage and moisture conservation.");
        }

        if (season.includes("Zaid")) {
          crops.push("üçâ Watermelon", "ü•í Cucumber", "üåΩ Baby Corn");
          activities.push("üíß Maintain irrigation cycles for fast-growing summer crops.");
        }

        if (ph < 5.5) {
          crops.push("üå∞ Groundnut", "üç† Sweet Potato");
          activities.push("üß™ Apply lime to reduce acidity in soil.");
        } else if (ph >= 5.5 && ph < 6) {
          crops.push("ü•¨ Spinach", "ü•¶ Broccoli", "üçÜ Eggplant");
          activities.push("üåø Good for leafy and root vegetables.");
        } else if (ph >= 7.5 && ph <= 8) {
          crops.push("üåæ Barley", "üçû Oats");
          activities.push("üßÇ Slightly alkaline soil‚Äîsuitable for grains like oats and barley.");
        }

        if (carbon < 5) {
          activities.push("ü™¥ Add compost or green manure to boost organic carbon.");
        } else if (carbon >= 5 && carbon < 10) {
          activities.push("üåø Maintain carbon with regular mulching.");
        }

        if (temp > 35) {
          crops.push("üçâ Watermelon", "üçä Orange");
          activities.push("‚òÄÔ∏è High heat crops‚Äîensure frequent watering.");
        } else if (temp < 20) {
          crops.push("ü•¨ Spinach", "ü•• Coconut");
          activities.push("‚ùÑÔ∏è Cooler weather crops recommended.");
        }

        if (crops.length === 0) {
          crops.push("‚ùå No suitable crops found for these conditions.");
        }

        output.innerHTML = `
          <h3>üìç Location: ${lat.toFixed(2)}, ${lon.toFixed(2)}</h3>
          <div class="icon-section">
            <span class="badge soil">üß™ Soil pH: ${ph.toFixed(2)}</span>
            <span class="badge temp">üå°Ô∏è Temp: ${temp}¬∞C</span>
            <span class="badge season">${season}</span>
          </div>
          <p><strong>Organic Carbon:</strong> ${carbon} g/kg</p>
          <hr>
          <h3>‚úÖ Recommended Crops:</h3>
          <ul>${crops.map(crop => `<li>${crop}</li>`).join("")}</ul>
          <h3>üîß Suggested Farming Activities:</h3>
          <ul>${activities.map(activity => `<li>${activity}</li>`).join("")}</ul>
        `;
      } catch (err) {
        console.error(err);
        output.innerHTML = "‚ùå Failed to fetch data. Please try again.";
      }
    });
  }
</script>
 